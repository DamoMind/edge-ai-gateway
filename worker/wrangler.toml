name = "edge-ai-gateway"
main = "worker.ts"
compatibility_date = "2024-01-01"

# ============================================
# 环境变量配置
# ============================================
# 非敏感变量在此配置，敏感变量用 wrangler secret 设置
#
# 设置敏感变量：
#   wrangler secret put AZURE_API_KEY
#   wrangler secret put AZURE_FOUNDRY_API_KEY
#   wrangler secret put OPENAI_API_KEY
#   wrangler secret put CF_API_TOKEN
#   wrangler secret put CLIENT_API_KEY
#   wrangler secret put GCP_SERVICE_ACCOUNT_JSON
#   wrangler secret put GEMINI_API_KEY
# ============================================

[vars]
# 选择 AI Provider: "azure" | "azure-foundry" | "openai" | "cloudflare" | "vertex"
AI_PROVIDER = "azure-foundry"

# Required for querying Analytics Engine SQL API from within the Worker
# CF_ACCOUNT_ID = "<your_cloudflare_account_id>"

# Azure OpenAI 配置（传统 Azure OpenAI Service）
# AZURE_ENDPOINT = "https://herea-m1tvkrzc-eastus2.openai.azure.com"
# AZURE_DEPLOYMENT = "gpt-4o"
# AZURE_API_VERSION = "2024-02-15-preview"

# Azure AI Foundry 配置（新版 Azure AI 服务）
# AZURE_FOUNDRY_ENDPOINT = "https://<your-foundry-endpoint>.services.ai.azure.com"
AZURE_FOUNDRY_MODEL = "gpt-4o"  # 默认模型，可在请求中覆盖

# Azure TTS 配置（cognitiveservices endpoint）
# AZURE_TTS_ENDPOINT = "https://<your-region>.cognitiveservices.azure.com"
AZURE_TTS_API_VERSION = "2025-03-01-preview"

# OpenAI 配置（如果使用 OpenAI）
# OPENAI_BASE_URL = "https://api.openai.com/v1"

# Cloudflare AI 配置（如果使用 Cloudflare AI）
# CF_ACCOUNT_ID = "your-account-id"
# CF_MODEL = "@cf/meta/llama-3.1-8b-instruct"

# Google Vertex AI 配置 (使用 GCP 积分)
# GCP_PROJECT_ID = "your-project-id"
# GCP_REGION = "us-central1"
# VERTEX_DEFAULT_MODEL = "gemini-2.0-flash"

# 可选：限制允许的域名（逗号分隔）
# ALLOWED_ORIGINS = "https://example.com,chrome-extension://xxx"

# ============================================
# Service Binding 使用说明
# ============================================
# 其他 Worker 可以通过 Service Binding 直接调用，无需 API Key
# 
# 在调用方 Worker 的 wrangler.toml 中添加：
# [[services]]
# binding = "AI_GATEWAY"
# service = "edge-ai-gateway"
#
# 调用方代码示例：
# const response = await env.AI_GATEWAY.fetch(
#   new Request('https://internal/v1/chat/completions', {
#     method: 'POST',
#     headers: { 'Content-Type': 'application/json' },
#     body: JSON.stringify({ model: 'gpt-4o', messages: [...] })
#   })
# );
#
# ============================================
# ============================================
# Analytics Engine (metrics)
# ============================================
[[analytics_engine_datasets]]
binding = "AE"
dataset = "edge_ai_gateway_usage"

# 生产环境配置示例
# ============================================
# [env.production]
# [env.production.vars]
# AI_PROVIDER = "azure-foundry"
# AZURE_FOUNDRY_ENDPOINT = "https://prod-project.region.models.ai.azure.com"
# AZURE_FOUNDRY_MODEL = "gpt-4o"
